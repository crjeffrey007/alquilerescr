// js/userPanel.js - flujo simple: lista y crear con prompts (si modal no usado)
import { auth, db } from './firebase.js';
import { collection, query, where, getDocs, addDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js';
import { initAuth } from './auth.js';
const myPosts = document.getElementById('myPosts'); const newBtn = document.getElementById('newPostBtn'); const pendingBadge = document.getElementById('pendingBadge');
async function render(uid){ myPosts.innerHTML='Cargando...'; const q = query(collection(db,'publicaciones'), where('usuarioUid','==', uid)); const snap = await getDocs(q); myPosts.innerHTML=''; let pend=0; snap.forEach(s=>{ const d=s.data(); const id=s.id; const card=document.createElement('div'); card.className='card'; card.innerHTML = `<h3>${d.titulo}</h3><p>${d.provincia||''}</p><p>Estado: ${d.estado||'pendiente'}</p><p><button data-id="${id}" class="del">Eliminar</button></p>`; myPosts.appendChild(card); if(d.estado==='pendiente') pend++; }); if(pend>0){ pendingBadge.style.display='inline-block'; pendingBadge.textContent=`${pend} pendientes`; } else pendingBadge.style.display='none'; myPosts.querySelectorAll('.del').forEach(b=>b.addEventListener('click', async ()=>{ if(!confirm('Eliminar?')) return; await deleteDoc(doc(db,'publicaciones',b.dataset.id)); render(uid); })); }
newBtn.addEventListener('click', async ()=>{ const tipo = prompt('Tipo (alquiler/venta/negocio):','alquiler'); const titulo = prompt('Título:'); if(!titulo) return; const provincia = prompt('Provincia:'); const canton = prompt('Cantón:'); const precio = prompt('Precio:'); const user = auth.currentUser; if(!user) return alert('Inicia sesión'); const data = { tipo, titulo, provincia, canton, precio, usuarioUid: user.uid, usuarioEmail: user.email, estado:'pendiente', createdAt: new Date() }; await addDoc(collection(db,'publicaciones'), data); alert('Creado'); render(user.uid); }); initAuth(user=>{ if(user) render(user.uid); else myPosts.innerHTML='<p>Inicia sesión para ver tu panel</p>'; });
<!doctype html>
<html lang="es"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Publicar Anuncio - Alquileres CR</title>
<link rel="stylesheet" href="css/styles.css"></head><body>
<header class="site-header"><div class="container"><h1>Publicar Anuncio</h1></div></header>
<main class="container">
<form id="form-anuncio" class="form">
  <label>Tipo*</label><select name="tipo"><option>Negocio</option><option>Servicio</option></select>
  <label>Título*</label><input name="titulo" required>
  <label>Descripción*</label><textarea name="descripcion" required></textarea>
  <label>Nombre del negocio</label><input name="nombreNegocio">
  <label>Teléfono*</label><input name="telefono" required>
  <label>Email</label><input type="email" name="email">
  <label>Logo</label><input type="file" id="logof" accept="image/*">
  <label>Imágenes</label><input type="file" id="fotosa" multiple accept="image/*">
  <label>Provincia</label><input name="provincia">
  <label>Cantón</label><input name="canton">
  <label>Categoría</label><input name="categoria">
  <label>Nombre anunciante*</label><input name="anunciante" required>
  <label><input type="checkbox" name="veracidad" required> Confirmo información verídica</label>
  <button type="submit">Enviar</button>
</form>
<div id="msga"></div>
</main>
<script src="js/firebase.js"></script>
<script src="js/cloudinary-upload.js"></script>
<script src="js/form-handler.js"></script>
<script>
document.getElementById('form-anuncio').addEventListener('submit', async function(e){
  e.preventDefault();
  const form = e.target;
  const logos = document.getElementById('logof').files;
  const fotos = document.getElementById('fotosa').files;
  document.getElementById('msga').textContent = 'Subiendo...';
  const urls = [];
  for(const f of Array.from(logos||[])){ urls.push(await uploadToCloudinary(f)); }
  for(const f of Array.from(fotos||[])){ urls.push(await uploadToCloudinary(f)); }
  if(window.db){ await db.collection('anunciosComerciales').add({ titulo: form.titulo.value, descripcion: form.descripcion.value, imagenes: urls, uid: (auth.currentUser && auth.currentUser.uid) || null, estado: 'pendiente', fechaPublicacion: firebase.firestore.FieldValue.serverTimestamp() }); }
  const fd = new FormData(form); fd.append('access_key','36e1e635-e0fa-4b58-adba-4daf2694b7dd'); fd.append('images', JSON.stringify(urls));
  await fetch('https://api.web3forms.com/submit',{method:'POST', body: fd});
  document.getElementById('msga').textContent = 'Enviado. Pendiente de aprobación.';
  form.reset();
});
</script>
</body></html>

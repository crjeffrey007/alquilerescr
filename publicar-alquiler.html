<!doctype html>
<html lang="es">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Publicar Alquiler - Alquileres CR</title>
<link rel="stylesheet" href="css/styles.css"></head>
<body>
<header class="site-header"><div class="container"><h1>Publicar Alquiler</h1></div></header>
<main class="container">
  <form id="form-alquiler" class="form">
    <label>Título*</label><input name="titulo" required>
    <label>Descripción*</label><textarea name="descripcion" required></textarea>
    <label>Fotos</label><input type="file" id="fotos" name="fotos" accept="image/*" multiple>
    <label>Provincia</label><input name="provincia">
    <label>Cantón</label><input name="canton">
    <label>Distrito</label><input name="distrito">
    <label>Precio</label><input name="precio" type="number">
    <label>Nombre*</label><input name="nombre" required>
    <label>Email*</label><input type="email" name="email" required>
    <label>Teléfono*</label><input name="telefono" required>
    <label><input type="checkbox" name="veracidad" required> Confirmo información verídica</label>
    <button type="submit">Enviar Anuncio</button>
  </form>
  <div id="msg"></div>
</main>
<script src="js/firebase.js"></script>
<script src="js/cloudinary-upload.js"></script>
<script src="js/form-handler.js"></script>
<script>
document.getElementById('form-alquiler').addEventListener('submit', async function(e){
  e.preventDefault();
  const form = e.target;
  const files = document.getElementById('fotos').files;
  document.getElementById('msg').textContent = 'Subiendo...';
  const urls = [];
  for(const f of files){ const u = await uploadToCloudinary(f); urls.push(u); }
  // Save to Firestore if configured (placeholder)
  if(window.db){ await db.collection('alquileres').add({ titulo: form.titulo.value, descripcion: form.descripcion.value, imagenes: urls, provincia: form.provincia.value, precio: form.precio.value, uid: (auth.currentUser && auth.currentUser.uid) || null, estado: 'pendiente', fechaPublicacion: firebase.firestore.FieldValue.serverTimestamp() }); }
  // send to Web3Forms
  const fd = new FormData(form); fd.append('access_key', '36e1e635-e0fa-4b58-adba-4daf2694b7dd'); fd.append('images', JSON.stringify(urls));
  await fetch('https://api.web3forms.com/submit', { method:'POST', body: fd });
  document.getElementById('msg').textContent = 'Enviado. Pendiente de aprobación.';
  form.reset();
});
</script>
</body>
</html>

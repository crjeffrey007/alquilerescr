<!doctype html>
<html lang="es"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Publicar Venta - Alquileres CR</title>
<link rel="stylesheet" href="css/styles.css"></head><body>
<header class="site-header"><div class="container"><h1>Publicar Venta</h1></div></header>
<main class="container">
<form id="form-venta" class="form">
  <label>Título*</label><input name="titulo" required>
  <label>Descripción*</label><textarea name="descripcion" required></textarea>
  <label>Fotos</label><input type="file" id="fotosv" name="fotos" accept="image/*" multiple>
  <label>Tipo de propiedad</label><select name="tipoPropiedad"><option>Casa</option><option>Apartamento</option></select>
  <label>Provincia</label><input name="provincia">
  <label>Precio</label><input name="precio" type="number">
  <label>Nombre*</label><input name="nombre" required>
  <label>Email*</label><input type="email" name="email" required>
  <label>Teléfono*</label><input name="telefono" required>
  <label><input type="checkbox" name="veracidad" required> Confirmo información verídica</label>
  <button type="submit">Enviar</button>
</form>
<div id="msgv"></div>
</main>
<script src="js/firebase.js"></script>
<script src="js/cloudinary-upload.js"></script>
<script src="js/form-handler.js"></script>
<script>
document.getElementById('form-venta').addEventListener('submit', async function(e){
  e.preventDefault();
  const form = e.target;
  const files = document.getElementById('fotosv').files;
  document.getElementById('msgv').textContent = 'Subiendo...';
  const urls = [];
  for(const f of files){ urls.push(await uploadToCloudinary(f)); }
  if(window.db){ await db.collection('ventas').add({ titulo: form.titulo.value, descripcion: form.descripcion.value, imagenes: urls, precio: form.precio.value, uid: (auth.currentUser && auth.currentUser.uid) || null, estado:'pendiente', fechaPublicacion: firebase.firestore.FieldValue.serverTimestamp() }); }
  const fd = new FormData(form); fd.append('access_key','36e1e635-e0fa-4b58-adba-4daf2694b7dd'); fd.append('images', JSON.stringify(urls));
  await fetch('https://api.web3forms.com/submit',{method:'POST', body: fd});
  document.getElementById('msgv').textContent = 'Enviado. Pendiente de aprobación.';
  form.reset();
});
</script>
</body></html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Admin - Alquileres CR</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  <script src="js/auth.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #fafafa; }
    h1 { color: #333; }
    section { margin-bottom: 40px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background: #f5f5f5; }
    button { padding: 6px 10px; margin: 3px; border: none; border-radius: 4px; cursor: pointer; }
    .btn-approve { background: #4CAF50; color: white; }
    .btn-delete { background: #e53935; color: white; }
    .btn-update { background: #2196F3; color: white; }
  </style>
</head>
<body>
  <h1>Panel de AdministraciÃ³n</h1>
  <button onclick="logoutUser()">Cerrar sesiÃ³n</button>

  <section id="usuarios">
    <h2>ðŸ‘¥ Usuarios registrados</h2>
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Email</th>
          <th>Plan</th>
          <th>Expira</th>
          <th>Publicaciones</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="listaUsuarios"></tbody>
    </table>
  </section>

  <section id="publicaciones">
    <h2>ðŸ“¢ Publicaciones pendientes</h2>
    <table>
      <thead>
        <tr>
          <th>TÃ­tulo</th>
          <th>CategorÃ­a</th>
          <th>Usuario</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="listaPublicaciones"></tbody>
    </table>
  </section>

  <script>
    const db = firebase.firestore();

    auth.onAuthStateChanged(async (user) => {
      if (!user) return (window.location.href = "login.html");

      const doc = await db.collection("usuarios").doc(user.uid).get();
      if (!doc.exists || doc.data().rol !== "admin") {
        alert("Acceso denegado.");
        return (window.location.href = "index.html");
      }

      cargarUsuarios();
      cargarPublicaciones();
    });

    // =========================
    // USUARIOS
    // =========================
    async function cargarUsuarios() {
      const snap = await db.collection("usuarios").get();
      const lista = document.getElementById("listaUsuarios");
      lista.innerHTML = "";

      snap.forEach((doc) => {
        const u = doc.data();
        const exp = u.fechaExpiracion ? new Date(u.fechaExpiracion.toDate ? u.fechaExpiracion.toDate() : u.fechaExpiracion) : "-";
        lista.innerHTML += `
          <tr>
            <td>${u.nombre}</td>
            <td>${u.email}</td>
            <td>${u.plan || "Gratis"}</td>
            <td>${exp instanceof Date ? exp.toLocaleDateString() : "-"}</td>
            <td>${u.publicacionesActuales || 0}/${u.limitePublicaciones || 0}</td>
            <td>
              <button class="btn-update" onclick="actualizarUsuario('${doc.id}')">Editar</button>
            </td>
          </tr>`;
      });
    }

    async function actualizarUsuario(uid) {
      const nuevoPlan = prompt("Nuevo plan (Gratis, BÃ¡sico, Premium):");
      const limite = parseInt(prompt("LÃ­mite de publicaciones:", "5"));
      const dias = parseInt(prompt("DuraciÃ³n en dÃ­as:", "30"));
      const expira = new Date();
      expira.setDate(expira.getDate() + dias);

      await db.collection("usuarios").doc(uid).update({
        plan: nuevoPlan,
        limitePublicaciones: limite,
        fechaExpiracion: expira
      });

      alert("âœ… Usuario actualizado correctamente");
      cargarUsuarios();
    }

    // =========================
    // PUBLICACIONES
    // =========================
    async function cargarPublicaciones() {
      const snap = await db.collection("publicaciones").get();
      const lista = document.getElementById("listaPublicaciones");
      lista.innerHTML = "";

      snap.forEach((doc) => {
        const p = doc.data();
        lista.innerHTML += `
          <tr>
            <td>${p.titulo}</td>
            <td>${p.categoria}</td>
            <td>${p.uid}</td>
            <td>${p.estado || "pendiente"}</td>
            <td>
              <button class="btn-approve" onclick="aprobarPublicacion('${doc.id}')">Aprobar</button>
              <button class="btn-delete" onclick="eliminarPublicacion('${doc.id}')">Eliminar</button>
            </td>
          </tr>`;
      });
    }

    async function aprobarPublicacion(id) {
      await db.collection("publicaciones").doc(id).update({ estado: "aprobada" });
      alert("âœ… PublicaciÃ³n aprobada");
      cargarPublicaciones();
    }

    async function eliminarPublicacion(id) {
      if (confirm("Â¿Eliminar esta publicaciÃ³n?")) {
        await db.collection("publicaciones").doc(id).delete();
        alert("ðŸ—‘ PublicaciÃ³n eliminada");
        cargarPublicaciones();
      }
    }
  </script>
</body>
</html>





































































<!doctype html><html lang="es"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Admin</title><link rel="stylesheet" href="css/style.css"></head><body><header class="site-header"><div class="container"><h1 class="logo">Panel Admin</h1></div></header><main class="container"><section class="admin-stats"><h2>Publicaciones pendientes: <span id="pendingCount">0</span></h2></section><section id="adminList" class="grid"></section></main><script type="module" src="js/firebase.js"></script><script type="module" src="js/admin.js"></script></body></html>
